# IM系统业务功能开发计划

## 项目概述
基于当前IM系统MVP基础，完善核心业务功能，提升用户体验，构建完整的即时通讯平台。

## 当前已实现功能 ✅
- [x] 私聊和群聊基础消息
- [x] 离线消息和未读计数
- [x] 消息历史记录和分页
- [x] 基本消息类型 (TEXT/IMAGE/ORDER_CARD)
- [x] WebSocket实时通信
- [x] 基础会话管理

---

## 🔴 第一优先级功能 (预计2-4周)

### 消息操作功能
- [x] **消息撤回功能** ✅ 2024-08-28 完成
  - [x] 数据库表结构扩展（添加撤回相关字段）
  - [x] 领域模型和DTO扩展
  - [x] 撤回业务逻辑实现（2分钟时间限制）
  - [x] WebSocket撤回消息处理
  - [x] REST API撤回接口
  - [x] 撤回通知广播机制
  - 实际完成时间: 2024-08-28

- [x] **消息删除功能** ✅ 2024-08-29 完成
  - [x] 仅自己可见删除
  - [x] 双方删除选项
  - [x] 删除确认弹窗
  - [x] 批量删除功能
  - 实际完成时间: 2024-08-29

- [x] **消息编辑功能** ✅ 2024-08-29 完成
  - [x] 编辑已发送文本消息
  - [x] 编辑历史记录
  - [x] 编辑时间限制（30分钟）
  - [x] 编辑标识显示
  - 实际完成时间: 2024-08-29

- [x] **消息回复/引用功能** ✅ 2024-08-29 完成
  - [x] 回复特定消息
  - [x] 引用消息显示
  - [x] 跳转到原消息
  - [x] 回复链显示
  - 实际完成时间: 2024-08-29

- [x] **消息转发功能** ✅ 2024-08-29 完成
  - [x] 选择转发目标
  - [x] 转发确认界面
  - [x] 转发消息格式
  - [x] 批量转发支持
  - 实际完成时间: 2024-08-29

### 消息状态跟踪
- [x] **已读回执功能** ✅ 2024-08-29 完成
  - [x] 私聊已读状态
  - [x] 群聊已读人数统计
  - [x] 已读状态图标显示
  - [x] 已读时间记录
  - 实际完成时间: 2024-08-29

- [x] **消息状态显示** ✅ 2024-08-29 完成
  - [x] 发送中状态
  - [x] 已送达状态  
  - [x] 发送失败重试
  - [x] 状态图标设计
  - 实际完成时间: 2024-08-29

### 实时交互提示
- [x] **正在输入提示** ✅ 2024-08-28 完成
  - [x] 输入状态检测和Redis存储管理
  - [x] WebSocket实时状态广播 (`/app/chat.typing`)
  - [x] 输入状态服务和定时清理任务
  - [x] 多人输入处理和冲突解决
  - [x] REST API查询接口
  - 实际完成时间: 2024-08-28

- [x] **在线状态显示** ✅ 2024-08-28 完成
  - [x] 用户状态枚举（在线/离线/忙碌/离开/隐身）
  - [x] Redis状态管理和过期机制
  - [x] WebSocket状态变更广播 (`/app/chat.userStatus`)
  - [x] 连接/断开事件自动状态更新
  - [x] REST API状态查询和设置
  - [x] 在线用户集合管理
  - 实际完成时间: 2024-08-28

- [ ] **消息表情反应**
  - [ ] 表情选择器
  - [ ] 反应统计显示
  - [ ] 取消反应功能
  - [ ] 反应通知推送
  - 预计完成时间: 2024-09-18

---

## 🟡 第二优先级功能 (预计4-8周)

### 好友系统
- [ ] **好友列表管理**
  - [ ] 好友列表展示
  - [ ] 好友分组功能
  - [ ] 好友备注设置
  - [ ] 好友排序规则
  - 预计完成时间: 2024-09-25

- [ ] **好友申请流程**
  - [ ] 添加好友请求
  - [ ] 申请审核通知
  - [ ] 同意/拒绝操作
  - [ ] 申请消息记录
  - 预计完成时间: 2024-09-28

- [ ] **用户搜索功能**
  - [ ] 按昵称搜索
  - [ ] 按用户ID搜索
  - [ ] 搜索结果展示
  - [ ] 添加好友入口
  - 预计完成时间: 2024-09-22

- [ ] **黑名单功能**
  - [ ] 拉黑用户操作
  - [ ] 黑名单管理页面
  - [ ] 解除拉黑功能
  - [ ] 拉黑状态处理
  - 预计完成时间: 2024-09-30

### 会话管理功能
- [ ] **消息免打扰**
  - [ ] 静音会话设置
  - [ ] 免打扰状态显示
  - [ ] 静音时间设定
  - [ ] 重要消息突破
  - 预计完成时间: 2024-10-05

- [ ] **置顶会话**
  - [ ] 会话置顶操作
  - [ ] 置顶排序逻辑
  - [ ] 置顶标识显示
  - [ ] 置顶数量限制
  - 预计完成时间: 2024-10-03

- [ ] **会话归档**
  - [ ] 归档不活跃会话
  - [ ] 归档列表管理
  - [ ] 恢复归档会话
  - [ ] 归档搜索功能
  - 预计完成时间: 2024-10-08

- [ ] **消息搜索**
  - [ ] 会话内消息搜索
  - [ ] 全局消息搜索
  - [ ] 搜索结果高亮
  - [ ] 搜索历史记录
  - 预计完成时间: 2024-10-12

### 群聊高级功能
- [ ] **@提醒功能**
  - [ ] @成员选择器
  - [ ] @全体成员
  - [ ] @消息高亮显示
  - [ ] @通知推送
  - 预计完成时间: 2024-10-15

- [ ] **群成员权限管理**
  - [ ] 管理员权限设置
  - [ ] 成员权限控制
  - [ ] 权限变更通知
  - [ ] 操作权限验证
  - 预计完成时间: 2024-10-18

- [ ] **群公告功能**
  - [ ] 发布群公告
  - [ ] 公告置顶显示
  - [ ] 公告历史记录
  - [ ] 公告通知推送
  - 预计完成时间: 2024-10-20

- [ ] **群邀请链接**
  - [ ] 生成邀请链接
  - [ ] 链接有效期设置
  - [ ] 通过链接加群
  - [ ] 邀请统计功能
  - 预计完成时间: 2024-10-22

---

## 🟢 第三优先级功能 (预计2-3个月)

### 富媒体消息
- [ ] **文件传输功能**
  - [ ] 文件上传下载
  - [ ] 文件类型支持
  - [ ] 传输进度显示
  - [ ] 文件大小限制
  - 预计完成时间: 2024-11-05

- [ ] **语音消息功能**
  - [ ] 语音录制功能
  - [ ] 语音播放控件
  - [ ] 语音时长显示
  - [ ] 语音转文字
  - 预计完成时间: 2024-11-10

- [ ] **位置分享功能**
  - [ ] 地图选择界面
  - [ ] 位置信息显示
  - [ ] 位置导航功能
  - [ ] 位置消息样式
  - 预计完成时间: 2024-11-15

- [ ] **链接预览功能**
  - [ ] 自动链接识别
  - [ ] 链接信息抓取
  - [ ] 预览卡片显示
  - [ ] 预览缓存机制
  - 预计完成时间: 2024-11-08

### 推送通知系统
- [ ] **离线推送功能**
  - [ ] 推送服务集成
  - [ ] 推送消息格式
  - [ ] 推送到达统计
  - [ ] 推送失败重试
  - 预计完成时间: 2024-11-20

- [ ] **通知设置功能**
  - [ ] 个人通知偏好
  - [ ] 通知免打扰时段
  - [ ] 通知声音设置
  - [ ] 通知内容隐私
  - 预计完成时间: 2024-11-25

- [ ] **消息优先级**
  - [ ] 重要消息标记
  - [ ] 紧急消息处理
  - [ ] 优先级通知策略
  - [ ] VIP消息提醒
  - 预计完成时间: 2024-11-28

### 高级特性
- [ ] **消息模板功能**
  - [ ] 快速回复模板
  - [ ] 模板管理界面
  - [ ] 模板分类组织
  - [ ] 模板使用统计
  - 预计完成时间: 2024-12-05

- [ ] **定时消息功能**
  - [ ] 定时发送设置
  - [ ] 定时任务管理
  - [ ] 定时消息取消
  - [ ] 定时发送通知
  - 预计完成时间: 2024-12-10

- [ ] **消息草稿功能**
  - [ ] 草稿自动保存
  - [ ] 草稿恢复功能
  - [ ] 多会话草稿管理
  - [ ] 草稿同步机制
  - 预计完成时间: 2024-12-08

- [ ] **多端同步功能**
  - [ ] 消息跨设备同步
  - [ ] 设备状态管理
  - [ ] 同步冲突处理
  - [ ] 离线数据同步
  - 预计完成时间: 2024-12-15

---

## 开发计划时间线

### 第一阶段 (2024年9月)
**目标**: 完成核心消息操作功能，提升基础用户体验
- Week 1-2: 消息撤回、正在输入、在线状态
- Week 3-4: 消息删除、编辑、已读回执

### 第二阶段 (2024年10月)
**目标**: 完善会话管理和好友系统
- Week 1-2: 消息回复、转发、用户搜索
- Week 3-4: 好友系统、会话管理功能

### 第三阶段 (2024年11月)
**目标**: 群聊高级功能和富媒体支持
- Week 1-2: @提醒、群管理功能
- Week 3-4: 文件传输、语音消息

### 第四阶段 (2024年12月)
**目标**: 推送通知和高级特性
- Week 1-2: 推送系统、通知设置
- Week 3-4: 消息模板、定时发送、多端同步

---

## 完成标记说明
- [x] ✅ 已完成
- [ ] ⏳ 进行中
- [ ] 📋 待开始
- [ ] ❌ 已取消
- [ ] ⚠️  有问题

## 更新日志
- 2024-08-28: 创建开发计划文档
- 2024-08-28: **消息撤回功能完成** - 实现了完整的消息撤回机制，包括数据库扩展、业务逻辑、WebSocket通信和时间限制验证
  - 数据库表结构扩展：添加撤回相关字段（is_recalled, recalled_at, recalled_by, recall_reason）
  - 业务逻辑：2分钟内撤回时间限制，权限验证，状态更新
  - API接口：WebSocket `/app/chat.recallMessage` 和 REST `/api/chat/messages/recall` 
  - 实时通知：通过WebSocket广播撤回事件给会话中的所有用户
- 2024-08-28: **正在输入提示功能完成** - 实现了输入状态的实时检测和广播机制
  - 输入状态管理：Redis存储、自动过期、定时清理任务
  - WebSocket广播：`/app/chat.typing` 端点，实时状态通知
  - 多用户支持：处理同时多人输入的场景
- 2024-08-28: **在线状态显示功能完成** - 实现了完整的用户状态管理系统
  - 用户状态枚举：支持在线/离线/忙碌/离开/隐身五种状态
  - Redis状态管理：状态持久化、过期机制、在线用户集合
  - WebSocket集成：连接/断开自动状态更新，实时状态广播
  - REST API：状态查询设置接口 `/api/chat/user-status`
- 2024-08-29: **IM系统核心功能模块完成** - 完成了完整的IM消息操作和状态管理功能集
  - **消息删除功能**：实现仅自己可见删除和双方删除，支持批量删除和确认弹窗
  - **消息编辑功能**：30分钟内可编辑文本消息，支持编辑历史记录和标识显示
  - **消息回复/引用功能**：支持回复特定消息、引用内容显示和跳转原消息
  - **消息转发功能**：完整的转发目标选择、确认界面和批量转发支持
  - **已读回执功能**：私聊和群聊已读状态、图标显示和时间记录
  - **消息状态显示**：发送中、已送达、失败重试等完整状态管理
  - **前端IM组件集成**：创建EnhancedChatArea和EnhancedMessageItem组件，完整UI支持

---

**备注**: 此计划根据实际开发进度可能会调整优先级和时间安排。每完成一个功能模块后，请更新对应的完成状态和完成时间。