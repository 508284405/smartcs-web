<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leyue.smartcs.chat.mapper.GroupMapper">
    
    <!-- 根据群ID查询群组信息 -->
    <select id="findByGroupId" resultType="com.leyue.smartcs.chat.dataobject.GroupDO">
        SELECT * FROM t_im_group 
        WHERE group_id = #{groupId} 
        AND is_deleted = 0
    </select>
    
    <!-- 根据群主ID查询群组列表 -->
    <select id="findByOwnerId" resultType="com.leyue.smartcs.chat.dataobject.GroupDO">
        SELECT * FROM t_im_group 
        WHERE owner_id = #{ownerId} 
        AND is_deleted = 0
        ORDER BY created_at DESC
    </select>
    
    <!-- 获取用户参与的群组列表（通过群成员表关联） -->
    <select id="findUserGroups" resultType="com.leyue.smartcs.chat.dataobject.GroupDO">
        SELECT g.* FROM t_im_group g
        INNER JOIN t_im_group_member gm ON g.group_id = gm.group_id
        WHERE gm.user_id = #{userId}
        AND g.is_deleted = 0
        AND gm.is_deleted = 0
        ORDER BY g.updated_at DESC
    </select>
    
    <!-- 软删除群组 -->
    <update id="deleteByGroupId">
        UPDATE t_im_group 
        SET is_deleted = 1, 
            updated_at = UNIX_TIMESTAMP() * 1000
        WHERE group_id = #{groupId} 
        AND is_deleted = 0
    </update>
    
</mapper>