<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leyue.smartcs.app.dao.AiAppMapper">

    <!-- 分页查询AI应用列表 -->
    <select id="selectAppPage" resultType="com.leyue.smartcs.app.dao.AiAppDO">
        SELECT * FROM t_ai_app
        WHERE is_deleted = 0
        <if test="creatorId != null">
            AND creator_id = #{creatorId}
        </if>
        <if test="type != null and type != ''">
            AND type = #{type}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%') 
                 OR description LIKE CONCAT('%', #{keyword}, '%')
                 OR code LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        ORDER BY created_at DESC
    </select>

    <!-- 统计AI应用数量 -->
    <select id="countApps" resultType="long">
        SELECT COUNT(*) FROM t_ai_app
        WHERE is_deleted = 0
        <if test="creatorId != null">
            AND creator_id = #{creatorId}
        </if>
        <if test="type != null and type != ''">
            AND type = #{type}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%') 
                 OR description LIKE CONCAT('%', #{keyword}, '%')
                 OR code LIKE CONCAT('%', #{keyword}, '%'))
        </if>
    </select>

    <!-- 根据编码查询应用（排除指定ID） -->
    <select id="selectByCodeExcludeId" resultType="com.leyue.smartcs.app.dao.AiAppDO">
        SELECT * FROM t_ai_app
        WHERE is_deleted = 0 
        AND code = #{code}
        <if test="excludeId != null">
            AND id != #{excludeId}
        </if>
        LIMIT 1
    </select>

</mapper>