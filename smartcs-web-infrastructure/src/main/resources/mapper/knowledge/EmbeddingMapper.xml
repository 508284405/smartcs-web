<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leyue.smartcs.knowledge.mapper.EmbeddingMapper">
    
    <!-- 根据文档ID查询所有向量 -->
    <select id="findByDocId" resultType="com.leyue.smartcs.knowledge.dataobject.EmbeddingDO">
        SELECT *
        FROM cs_doc_embedding
        WHERE is_deleted = 0
          AND doc_id = #{docId}
        ORDER BY section_idx
    </select>
    
    <!-- 根据文档ID和段落序号查询向量 -->
    <select id="findByDocIdAndSectionIdx" resultType="com.leyue.smartcs.knowledge.dataobject.EmbeddingDO">
        SELECT *
        FROM cs_doc_embedding
        WHERE is_deleted = 0
          AND doc_id = #{docId}
          AND section_idx = #{sectionIdx}
        LIMIT 1
    </select>
    
    <!-- 根据文档ID删除所有向量 -->
    <update id="deleteByDocId">
        UPDATE cs_doc_embedding
        SET is_deleted = 1
        WHERE doc_id = #{docId}
          AND is_deleted = 0
    </update>
    
</mapper> 