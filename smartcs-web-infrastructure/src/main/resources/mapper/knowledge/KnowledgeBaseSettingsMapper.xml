<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leyue.smartcs.knowledge.mapper.KnowledgeBaseSettingsMapper">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.leyue.smartcs.knowledge.dataobject.KnowledgeBaseSettingsDO">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="knowledge_base_id" property="knowledgeBaseId" jdbcType="BIGINT"/>
        <result column="indexing_mode" property="indexingMode" jdbcType="VARCHAR"/>
        <result column="embedding_model" property="embeddingModel" jdbcType="VARCHAR"/>
        <result column="vector_enabled" property="vectorEnabled" jdbcType="TINYINT"/>
        <result column="vector_top_k" property="vectorTopK" jdbcType="INTEGER"/>
        <result column="vector_score_threshold" property="vectorScoreThreshold" jdbcType="DECIMAL"/>
        <result column="full_text_enabled" property="fullTextEnabled" jdbcType="TINYINT"/>
        <result column="hybrid_enabled" property="hybridEnabled" jdbcType="TINYINT"/>
        <result column="hybrid_rerank_enabled" property="hybridRerankEnabled" jdbcType="TINYINT"/>
        <result column="created_by" property="createdBy" jdbcType="VARCHAR"/>
        <result column="updated_by" property="updatedBy" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="BIGINT"/>
        <result column="updated_at" property="updatedAt" jdbcType="BIGINT"/>
    </resultMap>

    <!-- 基础字段 -->
    <sql id="Base_Column_List">
        id, knowledge_base_id, indexing_mode, embedding_model, vector_enabled, vector_top_k, 
        vector_score_threshold, full_text_enabled, hybrid_enabled, hybrid_rerank_enabled,
        created_by, updated_by, created_at, updated_at
    </sql>

    <!-- 根据知识库ID查询设置 -->
    <select id="selectByKnowledgeBaseId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM t_kb_knowledge_base_settings
        WHERE knowledge_base_id = #{knowledgeBaseId}
    </select>

    <!-- 根据知识库ID更新设置 -->
    <update id="updateByKnowledgeBaseId">
        UPDATE t_kb_knowledge_base_settings
        SET
            indexing_mode = #{indexingMode,jdbcType=VARCHAR},
            embedding_model = #{embeddingModel,jdbcType=VARCHAR},
            vector_enabled = #{vectorEnabled,jdbcType=TINYINT},
            vector_top_k = #{vectorTopK,jdbcType=INTEGER},
            vector_score_threshold = #{vectorScoreThreshold,jdbcType=DECIMAL},
            full_text_enabled = #{fullTextEnabled,jdbcType=TINYINT},
            hybrid_enabled = #{hybridEnabled,jdbcType=TINYINT},
            hybrid_rerank_enabled = #{hybridRerankEnabled,jdbcType=TINYINT},
            updated_by = #{updatedBy,jdbcType=VARCHAR},
            updated_at = #{updatedAt,jdbcType=BIGINT}
        WHERE knowledge_base_id = #{knowledgeBaseId}
    </update>

</mapper>